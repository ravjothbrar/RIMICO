<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Artisan Todo | Personal Library</title>

  <!-- Book Emoji Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“š</text></svg>">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Framer Motion -->
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>

  <!-- Marked.js for Markdown -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            artisan: {
              purple: '#8B5CF6',
              purpleLight: '#A78BFA',
              purpleDark: '#7C3AED',
            }
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          }
        }
      }
    }
  </script>

  <style>
    * {
      box-sizing: border-box;
    }

    html, body, #root {
      margin: 0;
      padding: 0;
      height: 100vh;
      overflow: hidden;
      font-family: 'Inter', sans-serif;
    }

    /* Liquid Background with Purple Theme */
    .liquid-bg {
      background: linear-gradient(135deg, #FAF8FF 0%, #F5F0FF 50%, #EDE5FF 100%);
      position: relative;
      overflow: hidden;
    }

    /* SVG Filter for Gooey/Liquid Effect */
    .goo-container {
      filter: url(#goo);
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    /* Animated Purple Blobs */
    .blob {
      position: absolute;
      border-radius: 50%;
      filter: blur(0px);
      opacity: 0.7;
    }

    .blob-1 {
      width: 400px;
      height: 400px;
      background: radial-gradient(circle at 30% 30%, #A78BFA 0%, #8B5CF6 50%, #7C3AED 100%);
      top: -5%;
      left: -5%;
      animation: float1 25s ease-in-out infinite;
    }

    .blob-2 {
      width: 350px;
      height: 350px;
      background: radial-gradient(circle at 70% 30%, #C4B5FD 0%, #A78BFA 50%, #8B5CF6 100%);
      top: 10%;
      right: -8%;
      animation: float2 30s ease-in-out infinite;
    }

    .blob-3 {
      width: 300px;
      height: 300px;
      background: radial-gradient(circle at 50% 50%, #8B5CF6 0%, #7C3AED 50%, #6D28D9 100%);
      bottom: -10%;
      left: 15%;
      animation: float3 22s ease-in-out infinite;
    }

    .blob-4 {
      width: 250px;
      height: 250px;
      background: radial-gradient(circle at 40% 60%, #DDD6FE 0%, #C4B5FD 50%, #A78BFA 100%);
      bottom: 20%;
      right: 10%;
      animation: float4 28s ease-in-out infinite;
    }

    .blob-5 {
      width: 200px;
      height: 200px;
      background: radial-gradient(circle at 60% 40%, #A78BFA 0%, #8B5CF6 60%, #7C3AED 100%);
      top: 40%;
      left: 5%;
      animation: float5 20s ease-in-out infinite;
    }

    .blob-6 {
      width: 280px;
      height: 280px;
      background: radial-gradient(circle at 30% 70%, #7C3AED 0%, #6D28D9 50%, #5B21B6 100%);
      top: 60%;
      right: -5%;
      animation: float6 26s ease-in-out infinite;
    }

    .blob-7 {
      width: 180px;
      height: 180px;
      background: radial-gradient(circle at 50% 30%, #C4B5FD 0%, #A78BFA 50%, #8B5CF6 100%);
      top: 5%;
      left: 40%;
      animation: float7 24s ease-in-out infinite;
    }

    @keyframes float1 {
      0%, 100% { transform: translate(0, 0) scale(1) rotate(0deg); }
      25% { transform: translate(80px, 60px) scale(1.1) rotate(10deg); }
      50% { transform: translate(40px, 120px) scale(0.95) rotate(-5deg); }
      75% { transform: translate(-40px, 80px) scale(1.05) rotate(5deg); }
    }

    @keyframes float2 {
      0%, 100% { transform: translate(0, 0) scale(1) rotate(0deg); }
      25% { transform: translate(-70px, 80px) scale(1.05) rotate(-8deg); }
      50% { transform: translate(-100px, 40px) scale(1.1) rotate(5deg); }
      75% { transform: translate(-50px, -40px) scale(0.95) rotate(-3deg); }
    }

    @keyframes float3 {
      0%, 100% { transform: translate(0, 0) scale(1) rotate(0deg); }
      25% { transform: translate(60px, -50px) scale(1.08) rotate(12deg); }
      50% { transform: translate(120px, -80px) scale(0.92) rotate(-8deg); }
      75% { transform: translate(40px, -30px) scale(1.04) rotate(4deg); }
    }

    @keyframes float4 {
      0%, 100% { transform: translate(0, 0) scale(1) rotate(0deg); }
      25% { transform: translate(-60px, -70px) scale(0.95) rotate(-10deg); }
      50% { transform: translate(-30px, 50px) scale(1.1) rotate(8deg); }
      75% { transform: translate(40px, -20px) scale(1.02) rotate(-5deg); }
    }

    @keyframes float5 {
      0%, 100% { transform: translate(0, 0) scale(1) rotate(0deg); }
      25% { transform: translate(50px, -60px) scale(1.12) rotate(15deg); }
      50% { transform: translate(80px, 30px) scale(0.9) rotate(-10deg); }
      75% { transform: translate(20px, 70px) scale(1.05) rotate(5deg); }
    }

    @keyframes float6 {
      0%, 100% { transform: translate(0, 0) scale(1) rotate(0deg); }
      25% { transform: translate(-80px, -50px) scale(1.06) rotate(-12deg); }
      50% { transform: translate(-40px, -100px) scale(0.94) rotate(6deg); }
      75% { transform: translate(30px, -60px) scale(1.08) rotate(-4deg); }
    }

    @keyframes float7 {
      0%, 100% { transform: translate(0, 0) scale(1) rotate(0deg); }
      25% { transform: translate(-40px, 80px) scale(0.92) rotate(8deg); }
      50% { transform: translate(60px, 60px) scale(1.15) rotate(-12deg); }
      75% { transform: translate(30px, -30px) scale(1.02) rotate(6deg); }
    }

    /* Purple Banner */
    .purple-banner {
      background: linear-gradient(90deg, #EDE9FE 0%, #DDD6FE 50%, #EDE9FE 100%);
      border-bottom: 1px solid rgba(139, 92, 246, 0.2);
    }

    /* Mahogany Shelf */
    .shelf {
      background: linear-gradient(180deg, #8B7355 0%, #6B4423 30%, #4A2C2A 50%, #6B4423 70%, #8B7355 100%);
      box-shadow: 0 4px 12px rgba(0,0,0,0.25), inset 0 1px 2px rgba(255,255,255,0.1);
    }

    /* 3D Book Spine */
    .book-spine {
      transform-style: preserve-3d;
      perspective: 800px;
    }

    .book-spine-inner {
      transform: rotateY(-4deg);
      box-shadow: 4px 4px 10px rgba(0,0,0,0.35), -2px 0 4px rgba(0,0,0,0.15), inset -4px 0 8px rgba(0,0,0,0.25), inset 2px 0 4px rgba(255,255,255,0.1);
    }

    .book-spine-inner::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: linear-gradient(90deg, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0.1) 100%);
    }

    /* Page Flicker Animation */
    @keyframes pageFlicker {
      0%, 100% { transform: scaleX(1); opacity: 1; }
      25% { transform: scaleX(0.96); opacity: 0.9; }
      50% { transform: scaleX(1.02); opacity: 1; }
      75% { transform: scaleX(0.98); opacity: 0.92; }
    }

    .page-flicker {
      animation: pageFlicker 0.5s ease-in-out;
    }

    /* Custom Scrollbar */
    .custom-scrollbar::-webkit-scrollbar {
      height: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
      background: rgba(139, 92, 246, 0.1);
      border-radius: 2px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #8B5CF6;
      border-radius: 2px;
    }

    /* Modal Backdrop */
    .modal-backdrop {
      background: rgba(0,0,0,0.35);
      backdrop-filter: blur(4px);
    }

    /* Book Page Spread */
    .page-spread {
      background: linear-gradient(90deg, #FEFEFE 0%, #F8F8F8 49%, #E5E5E5 49%, #E5E5E5 51%, #F8F8F8 51%, #FEFEFE 100%);
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    }

    /* Vertical Text */
    .vertical-text {
      writing-mode: vertical-rl;
      text-orientation: mixed;
      transform: rotate(180deg);
    }

    /* Focus States */
    input:focus, button:focus, select:focus, textarea:focus {
      outline: none;
      box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.3);
    }

    /* Markdown Styles */
    .markdown-content strong { font-weight: 600; }
    .markdown-content em { font-style: italic; }
    .markdown-content p { margin-bottom: 0.5rem; }
    .markdown-content code {
      background: rgba(139, 92, 246, 0.1);
      padding: 0.125rem 0.25rem;
      border-radius: 0.25rem;
      font-size: 0.8rem;
    }

    /* Attribution Button */
    .attribution-btn {
      border: 1.5px solid rgba(139, 92, 246, 0.25);
      transition: all 0.2s ease;
    }
    .attribution-btn:hover {
      border-color: #8B5CF6;
      background: rgba(139, 92, 246, 0.08);
    }

    /* Title Click Effect */
    .title-link {
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .title-link:hover {
      transform: scale(1.02);
      text-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
    }
  </style>
</head>
<body>
  <!-- SVG Filter for Gooey Effect -->
  <svg style="position: absolute; width: 0; height: 0;">
    <defs>
      <filter id="goo">
        <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur" />
        <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 25 -12" result="goo" />
        <feComposite in="SourceGraphic" in2="goo" operator="atop" />
      </filter>
    </defs>
  </svg>

  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { motion, AnimatePresence } = Motion;

    const useLocalStorage = (key, initialValue) => {
      const [storedValue, setStoredValue] = useState(() => {
        try {
          const item = window.localStorage.getItem(key);
          return item ? JSON.parse(item) : initialValue;
        } catch (error) {
          return initialValue;
        }
      });

      const setValue = (value) => {
        try {
          const valueToStore = value instanceof Function ? value(storedValue) : value;
          setStoredValue(valueToStore);
          window.localStorage.setItem(key, JSON.stringify(valueToStore));
        } catch (error) {}
      };

      return [storedValue, setValue];
    };

    const SHELF_COLORS = {
      'Personal': { accent: '#8B5CF6', textColor: 'text-purple-100', bgClass: 'bg-gradient-to-b from-purple-500 via-purple-600 to-purple-800' },
      'School': { accent: '#1E40AF', textColor: 'text-blue-100', bgClass: 'bg-gradient-to-b from-blue-600 via-blue-700 to-blue-900' },
      'Beri': { accent: '#047857', textColor: 'text-emerald-100', bgClass: 'bg-gradient-to-b from-emerald-500 via-emerald-600 to-emerald-800' },
      'AI': { accent: '#0891B2', textColor: 'text-cyan-100', bgClass: 'bg-gradient-to-b from-cyan-500 via-cyan-600 to-cyan-800' }
    };

    const TIMEFRAME_WIDTHS = { 'quick': 45, 'short': 60, 'medium': 75, 'long': 95, 'extended': 115 };

    const Icons = {
      Plus: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>,
      Archive: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" /></svg>,
      Book: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>,
      Check: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>,
      X: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>,
      Calendar: () => <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
      Trash: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>,
      Restore: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" /></svg>,
      User: () => <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>,
      GitHub: () => <svg className="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
    };

    const MarkdownContent = ({ content }) => {
      if (!content) return <span className="text-gray-400 italic text-sm">No description provided.</span>;
      const html = marked.parse(content, { breaks: true });
      return <div className="markdown-content text-gray-700 leading-relaxed text-sm" dangerouslySetInnerHTML={{ __html: html }} />;
    };

    const AttributionLink = () => (
      <a href="https://ravjothbrar.com" target="_blank" rel="noopener noreferrer" className="attribution-btn inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-white/90 text-gray-600 text-xs font-medium">
        <Icons.User />Created by Ravjoth
      </a>
    );

    const GitHubPagesButton = () => (
      <a href="https://pages.github.com" target="_blank" rel="noopener noreferrer" className="attribution-btn inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-white/90 text-gray-600 text-xs font-medium">
        <Icons.GitHub />GitHub Pages
      </a>
    );

    const AnimatedBlobs = () => (
      <div className="goo-container">
        <div className="blob blob-1" />
        <div className="blob blob-2" />
        <div className="blob blob-3" />
        <div className="blob blob-4" />
        <div className="blob blob-5" />
        <div className="blob blob-6" />
        <div className="blob blob-7" />
      </div>
    );

    const BookSpine = ({ task, onClick, onComplete, isFlickering }) => {
      const shelfColor = SHELF_COLORS[task.label] || SHELF_COLORS['Personal'];
      const width = TIMEFRAME_WIDTHS[task.timeframe] || TIMEFRAME_WIDTHS['medium'];

      return (
        <motion.div
          className="book-spine relative cursor-pointer mx-1 flex-shrink-0"
          style={{ width: `${width}px` }}
          initial={{ opacity: 0, y: 10 }}
          animate={{ opacity: 1, y: 0 }}
          exit={{ opacity: 0, scale: 0.8, y: -20 }}
          whileHover={{ y: -12, scale: 1.1, rotateY: -8 }}
          transition={{ type: "spring", stiffness: 400, damping: 25 }}
          onClick={onClick}
        >
          <div className={`book-spine-inner h-full rounded-sm ${shelfColor.bgClass} ${isFlickering ? 'page-flicker' : ''} relative overflow-hidden`}>
            <div className="absolute top-2 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-yellow-400/50 to-transparent" />
            <div className="absolute bottom-2 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-yellow-400/50 to-transparent" />
            <div className={`vertical-text h-full flex items-center justify-center px-1.5 ${shelfColor.textColor}`}>
              <span className="font-semibold text-xs tracking-wide truncate">{task.name}</span>
            </div>
            <motion.button
              className="absolute bottom-1.5 left-1/2 -translate-x-1/2 w-6 h-6 rounded-full bg-white/20 hover:bg-white/40 flex items-center justify-center"
              onClick={(e) => { e.stopPropagation(); onComplete(task.id); }}
              whileHover={{ scale: 1.15 }}
              whileTap={{ scale: 0.9 }}
            >
              <Icons.Check />
            </motion.button>
          </div>
        </motion.div>
      );
    };

    const ShelfQuadrant = ({ label, tasks, onBookClick, onComplete, flickeringId }) => {
      const shelfColor = SHELF_COLORS[label] || SHELF_COLORS['Personal'];

      return (
        <div className="flex flex-col h-full">
          <div className="flex items-center gap-2 mb-1 px-2">
            <div className="w-2.5 h-2.5 rounded-full" style={{ backgroundColor: shelfColor.accent }} />
            <h3 className="text-sm font-bold text-artisan-purple">{label}</h3>
            <span className="text-xs text-gray-400">{tasks.length}</span>
          </div>
          <div className="flex-1 relative">
            <div className="custom-scrollbar overflow-x-auto h-full">
              <div className="flex items-end h-[calc(100%-20px)] px-2 pt-2">
                <AnimatePresence mode="popLayout">
                  {tasks.length === 0 ? (
                    <div className="text-xs text-gray-400 italic px-2">Empty shelf...</div>
                  ) : (
                    tasks.map((task) => (
                      <BookSpine key={task.id} task={task} onClick={() => onBookClick(task)} onComplete={onComplete} isFlickering={flickeringId === task.id} />
                    ))
                  )}
                </AnimatePresence>
              </div>
            </div>
            <div className="shelf absolute bottom-0 left-1 right-1 h-5 rounded-b-sm" />
          </div>
        </div>
      );
    };

    const PageSpreadModal = ({ task, onClose, onComplete, onDelete }) => {
      const shelfColor = SHELF_COLORS[task.label] || SHELF_COLORS['Personal'];
      const formatDate = (ds) => ds ? new Date(ds).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }) : 'No due date';

      return (
        <motion.div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} onClick={onClose}>
          <motion.div className="page-spread relative w-full max-w-lg rounded-xl overflow-hidden" initial={{ scale: 0.9, rotateY: -45 }} animate={{ scale: 1, rotateY: 0 }} exit={{ scale: 0.9, rotateY: 45 }} transition={{ type: "spring", stiffness: 250, damping: 25 }} onClick={(e) => e.stopPropagation()}>
            <button onClick={onClose} className="absolute top-3 right-3 w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center z-10"><Icons.X /></button>
            <div className="p-6">
              <div className="flex items-start gap-3 mb-4">
                <div className="w-1.5 h-16 rounded-full" style={{ backgroundColor: shelfColor.accent }} />
                <div className="flex-1">
                  <span className="text-xs font-semibold uppercase tracking-wider px-2 py-0.5 rounded-full" style={{ backgroundColor: `${shelfColor.accent}15`, color: shelfColor.accent }}>{task.label}</span>
                  <h2 className="text-xl font-bold text-gray-800 mt-2">{task.name}</h2>
                  <div className="flex items-center gap-1.5 text-gray-500 text-xs mt-1"><Icons.Calendar /><span>{formatDate(task.dueDate)}</span></div>
                </div>
              </div>
              <div className="border-t border-gray-200 my-4" />
              <div className="mb-4">
                <h4 className="text-xs font-semibold uppercase tracking-wider text-gray-400 mb-2">Description</h4>
                <MarkdownContent content={task.description} />
              </div>
              <div className="mb-5">
                <h4 className="text-xs font-semibold uppercase tracking-wider text-gray-400 mb-2">Timeframe</h4>
                <span className="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-purple-100 text-purple-700 capitalize">{task.timeframe}</span>
              </div>
              <div className="flex gap-2">
                <motion.button className="flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-artisan-purple text-white rounded-lg text-sm font-semibold hover:bg-artisan-purpleDark" whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} onClick={() => { onComplete(task.id); onClose(); }}><Icons.Check />Complete</motion.button>
                <motion.button className="flex items-center justify-center px-4 py-2.5 bg-red-50 text-red-600 rounded-lg text-sm font-semibold hover:bg-red-100" whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} onClick={() => { onDelete(task.id); onClose(); }}><Icons.Trash /></motion.button>
              </div>
            </div>
          </motion.div>
        </motion.div>
      );
    };

    const AddTaskModal = ({ onClose, onAdd }) => {
      const [formData, setFormData] = useState({ name: '', label: 'Personal', description: '', dueDate: '', timeframe: 'medium' });
      const handleSubmit = (e) => { e.preventDefault(); if (formData.name.trim()) { onAdd({ ...formData, id: Date.now().toString(), completed: false, createdAt: new Date().toISOString() }); onClose(); } };

      return (
        <motion.div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} onClick={onClose}>
          <motion.div className="bg-white rounded-xl w-full max-w-sm overflow-hidden shadow-xl" initial={{ scale: 0.9, y: 20 }} animate={{ scale: 1, y: 0 }} exit={{ scale: 0.9, y: 20 }} onClick={(e) => e.stopPropagation()}>
            <div className="p-5">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-lg font-bold text-gray-800">Add Book</h2>
                <button onClick={onClose} className="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-500"><Icons.X /></button>
              </div>
              <form onSubmit={handleSubmit} className="space-y-3">
                <div>
                  <label className="block text-xs font-semibold text-gray-600 mb-1">Title *</label>
                  <input type="text" required value={formData.name} onChange={(e) => setFormData({ ...formData, name: e.target.value })} className="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-800 placeholder-gray-400" placeholder="Task name" />
                </div>
                <div>
                  <label className="block text-xs font-semibold text-gray-600 mb-1">Shelf</label>
                  <div className="grid grid-cols-4 gap-1">
                    {Object.keys(SHELF_COLORS).map((label) => (
                      <button key={label} type="button" onClick={() => setFormData({ ...formData, label })} className={`px-2 py-1.5 rounded-lg text-xs font-medium transition-all ${formData.label === label ? 'ring-2 ring-artisan-purple bg-purple-50 text-artisan-purple' : 'bg-gray-50 text-gray-600 hover:bg-gray-100'}`}>
                        <span className="inline-block w-2 h-2 rounded-full mr-1" style={{ backgroundColor: SHELF_COLORS[label].accent }} />{label}
                      </button>
                    ))}
                  </div>
                </div>
                <div>
                  <label className="block text-xs font-semibold text-gray-600 mb-1">Description <span className="font-normal text-gray-400">(markdown)</span></label>
                  <textarea value={formData.description} onChange={(e) => setFormData({ ...formData, description: e.target.value })} rows={2} className="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-800 placeholder-gray-400 resize-none" placeholder="**bold**, *italic*..." />
                </div>
                <div className="grid grid-cols-2 gap-2">
                  <div>
                    <label className="block text-xs font-semibold text-gray-600 mb-1">Due Date</label>
                    <input type="date" value={formData.dueDate} onChange={(e) => setFormData({ ...formData, dueDate: e.target.value })} className="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-800" />
                  </div>
                  <div>
                    <label className="block text-xs font-semibold text-gray-600 mb-1">Timeframe</label>
                    <select value={formData.timeframe} onChange={(e) => setFormData({ ...formData, timeframe: e.target.value })} className="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-800">
                      <option value="quick">Quick</option><option value="short">Short</option><option value="medium">Medium</option><option value="long">Long</option><option value="extended">Extended</option>
                    </select>
                  </div>
                </div>
                <motion.button type="submit" className="w-full px-4 py-2.5 bg-artisan-purple text-white rounded-lg text-sm font-semibold hover:bg-artisan-purpleDark" whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }}>Add to Library</motion.button>
              </form>
            </div>
          </motion.div>
        </motion.div>
      );
    };

    const ArchiveView = ({ tasks, onRestore, onDelete }) => {
      const formatDate = (ds) => new Date(ds).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      return (
        <div className="h-full overflow-auto p-4">
          <h2 className="text-lg font-bold text-artisan-purple mb-3">Archived</h2>
          {tasks.length === 0 ? (
            <div className="text-center py-8 text-gray-400 text-sm">No archived books</div>
          ) : (
            <div className="space-y-2">
              {tasks.map((task) => {
                const shelfColor = SHELF_COLORS[task.label] || SHELF_COLORS['Personal'];
                return (
                  <div key={task.id} className="bg-white/90 rounded-lg p-3 flex items-center gap-3 shadow-sm">
                    <div className="w-1.5 h-10 rounded-full" style={{ backgroundColor: shelfColor.accent }} />
                    <div className="flex-1 min-w-0">
                      <h4 className="font-medium text-sm text-gray-800 truncate">{task.name}</h4>
                      <p className="text-xs text-gray-500">{formatDate(task.completedAt)}</p>
                    </div>
                    <button onClick={() => onRestore(task.id)} className="p-1.5 rounded bg-purple-50 text-artisan-purple hover:bg-purple-100"><Icons.Restore /></button>
                    <button onClick={() => onDelete(task.id)} className="p-1.5 rounded bg-red-50 text-red-500 hover:bg-red-100"><Icons.Trash /></button>
                  </div>
                );
              })}
            </div>
          )}
        </div>
      );
    };

    const App = () => {
      const [tasks, setTasks] = useLocalStorage('artisan-todo-tasks', []);
      const [activeView, setActiveView] = useState('library');
      const [showAddModal, setShowAddModal] = useState(false);
      const [selectedTask, setSelectedTask] = useState(null);
      const [flickeringId, setFlickeringId] = useState(null);

      const activeTasks = tasks.filter(t => !t.completed);
      const archivedTasks = tasks.filter(t => t.completed);

      const sortByDueDate = (tasks) => [...tasks].sort((a, b) => {
        if (!a.dueDate && !b.dueDate) return 0;
        if (!a.dueDate) return 1;
        if (!b.dueDate) return -1;
        return new Date(a.dueDate) - new Date(b.dueDate);
      });

      const tasksByLabel = Object.keys(SHELF_COLORS).reduce((acc, label) => {
        acc[label] = sortByDueDate(activeTasks.filter(t => t.label === label));
        return acc;
      }, {});

      const handleComplete = (taskId) => {
        setFlickeringId(taskId);
        setTimeout(() => {
          setTasks(tasks.map(t => t.id === taskId ? { ...t, completed: true, completedAt: new Date().toISOString() } : t));
          setFlickeringId(null);
        }, 500);
      };

      const handleRestore = (taskId) => setTasks(tasks.map(t => t.id === taskId ? { ...t, completed: false, completedAt: null } : t));
      const handleDelete = (taskId) => setTasks(tasks.filter(t => t.id !== taskId));
      const handleAddTask = (newTask) => setTasks([...tasks, newTask]);
      const goToLibrary = () => setActiveView('library');

      const shelfLabels = Object.keys(SHELF_COLORS);

      return (
        <div className="liquid-bg h-screen flex flex-col">
          {/* Animated Purple Blobs */}
          <AnimatedBlobs />

          {/* Purple Banner Header */}
          <header className="purple-banner relative z-10 px-4 py-3">
            <div className="flex items-center justify-between">
              <AttributionLink />
              <h1
                onClick={goToLibrary}
                className="title-link text-2xl font-extrabold text-artisan-purple"
              >
                Artisan Todo
              </h1>
              <div className="flex items-center gap-2">
                <div className="bg-white/90 rounded-full p-0.5 flex shadow-sm">
                  <button onClick={() => setActiveView('library')} className={`px-3 py-1.5 rounded-full text-xs font-semibold flex items-center gap-1 transition-all ${activeView === 'library' ? 'bg-artisan-purple text-white' : 'text-gray-500 hover:text-gray-700'}`}><Icons.Book />Library</button>
                  <button onClick={() => setActiveView('archive')} className={`px-3 py-1.5 rounded-full text-xs font-semibold flex items-center gap-1 transition-all ${activeView === 'archive' ? 'bg-artisan-purple text-white' : 'text-gray-500 hover:text-gray-700'}`}><Icons.Archive />{archivedTasks.length}</button>
                </div>
                <motion.button onClick={() => setShowAddModal(true)} className="w-9 h-9 rounded-full bg-artisan-purple text-white flex items-center justify-center shadow-lg shadow-purple-300/50" whileHover={{ scale: 1.1 }} whileTap={{ scale: 0.9 }}><Icons.Plus /></motion.button>
              </div>
            </div>
          </header>

          {/* Main Content */}
          <main className="relative z-10 flex-1 px-4 pb-2 overflow-hidden">
            <AnimatePresence mode="wait">
              {activeView === 'library' ? (
                <motion.div key="library" className="h-full grid grid-cols-2 grid-rows-2 gap-3" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>
                  {shelfLabels.map((label) => (
                    <div key={label} className="bg-white/50 backdrop-blur-sm rounded-xl p-2 overflow-hidden border border-white/60">
                      <ShelfQuadrant label={label} tasks={tasksByLabel[label]} onBookClick={setSelectedTask} onComplete={handleComplete} flickeringId={flickeringId} />
                    </div>
                  ))}
                </motion.div>
              ) : (
                <motion.div key="archive" className="h-full bg-white/50 backdrop-blur-sm rounded-xl overflow-hidden border border-white/60" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>
                  <ArchiveView tasks={archivedTasks} onRestore={handleRestore} onDelete={handleDelete} />
                </motion.div>
              )}
            </AnimatePresence>
          </main>

          {/* Footer */}
          <footer className="relative z-10 flex items-center justify-center gap-3 py-2">
            <AttributionLink />
            <GitHubPagesButton />
          </footer>

          {/* Modals */}
          <AnimatePresence>
            {showAddModal && <AddTaskModal onClose={() => setShowAddModal(false)} onAdd={handleAddTask} />}
            {selectedTask && <PageSpreadModal task={selectedTask} onClose={() => setSelectedTask(null)} onComplete={handleComplete} onDelete={handleDelete} />}
          </AnimatePresence>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
